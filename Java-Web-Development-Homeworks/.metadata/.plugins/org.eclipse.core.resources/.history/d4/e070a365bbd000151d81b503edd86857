package bg.jwd.ejb;

import java.util.Map;

import javax.ejb.EJB;
import javax.ejb.Stateful;
import javax.servlet.http.HttpServletRequest;

@Stateful
public class BankOperationImpl implements BankOperation {
	
	@Override
	public void deposite(Map<String, Double> users, String currentUser, double depositMoney) {
		double userAmount = userOperation.getUserAmount(users, currentUser);
		
		servletRequest.getSession().setAttribute("username", currentUser);
		servletRequest.getSession().setAttribute("amount", userAmount);
		
		if(depositMoney > 0){
			userAmount += depositMoney;
		}
		
		users.put(currentUser, userAmount);
	}

	@Override
	public void withdraw(Map<String, Double> users, String currentUser, double withdrawMoney) {
		double userAmount = userOperation.getUserAmount(users, currentUser);
		
		if(withdrawMoney > 0 && withdrawMoney <= userAmount){
			userAmount -= withdrawMoney;
		}
		
		users.put(currentUser, userAmount);
	}
	
	@EJB
	private UserOperation userOperation;
	
	private HttpServletRequest servletRequest;

}
