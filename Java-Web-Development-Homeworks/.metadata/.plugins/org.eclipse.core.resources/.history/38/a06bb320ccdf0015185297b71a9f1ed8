package bg.jwd.webBank.controllers;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import bg.jwd.webBank.entities.Account;
import bg.jwd.webBank.services.BankAccountService;

@Controller
public class BankOperationController extends BaseController {

	@Autowired
	private BankAccountService bankOperation;

	@RequestMapping(value = "/bankOperation", method = RequestMethod.GET)
	public String getRegisterUser() {
		return "bankOperation";
	}

	@RequestMapping(value = "/bankOperation", method = RequestMethod.POST)
	public String registerUser(HttpServletRequest request) {
		String accNum = request.getParameter("accNumber");
		String operation = request.getParameter("deposit_withdraw");
		Double amount = (Double) request.getParameter("amount_to_change");
		Account acc = this.db.getAccount(accNum);

		if (acc == null) {
			return "redirect:/registerAccount";
		}

		request.getSession().setAttribute("balance_per_day", acc.getInitialAmount());

		if (operation.equals("deposite")) {
			bankOperation.deposite(acc, amount);
		}

		// this.db.addUser(user);

		return "redirect:/home";
	}
}
